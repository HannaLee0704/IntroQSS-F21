---
  title: "Problem set 7"
author: "Your name here"
date: "Due 11/12/2021 at 5pm"
output: pdf_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(estimatr)
```

*\textsc{Note}: Start with the file `ps7_2021.Rmd` (available from the github repository at https://github.com/UChicago-pol-methods/IntroQSS-F21/tree/main/assignments). Modify that file to include your answers. Make sure you can "knit" the file (e.g. in RStudio by clicking on the `Knit` button). Submit both the Rmd file and the knitted PDF via Canvas*

In this assignment we will examine data from an experiment that measured the effect of different messages on Michigan residents' likelihood of voting in the August 2006 primary election. The published paper is 

Gerber, Alan S., Donald P. Green, and Christopher W. Larimer. 2008. "Social Pressure and Voter Turnout: Evidence from a Large-Scale Experiment." *American Political Science Review* 102(1): 33-48.

The data file is `ggl.RData` and it is found in the `data` directory of the course github repository.

To load the data you can either read in the same local file as you did in problem set 5, or you can read in the url from github. Note that this will only work when you have an internet connection: 

```{r load-data}
load(url("https://github.com/UChicago-pol-methods/IntroQSS-F21/raw/main/data/ggl.RData"))
```

The dataset will be loaded as an object called `ggl`.

The variables in the dataset are as follows: 

- ```sex```: male or female
- ```yob```: year of birth
- ```g2000```, ```g2002```, ```g2004```:  did this voter vote in the general elections in November of 2000, 2002, 2004? (binary)
- ```p2000```, ```p2002```, ```p2004```:  did this voter vote in the primary elections of August 2000, 2002, 2004? (binary)
- ```treatment```:  which of the five treatment did this voter's household receive?
    + "Control": No mailing
    + "CivicDuty": A mailing encouraging voting
    + "Hawthorne": A mailing encouraging voting and saying that the sender will `be studying voter turnout in the August 8 primary election'
    + "Self": A mailing encouraging voting and showing the recipients' past turnout,  saying `We intend to mail you an updated chart when we have that information'
    + "Neighbors": Same thing, except including information on turnout by neighbors as well
- ```cluster```: in what cluster of households was this voter's house located?
- ```voted```: did the voter vote in the primary election of 2006?
- ```hh_id```: what is the id number of this voter's household?
- ```hh_size```: how many voters are in this household? 

Don't change the below:
```{r}
# We will only consider in our analysis households that were assigned the `Control` condition or the `CivicDuty` condition. 
ggl <- ggl %>% 
  filter(treatment == 'Control' | treatment == 'CivicDuty')
```


## Question 1: Randomization Inference

Suppose we are only interested in conducting inference over the voters included in the study, and we are interested in treatment effects of the various treatment conditions relative to control. Treatment was assigned randomly by the researchers, and we know the treatment assignment probabilities. 

We will set a seed, because we'll use some random re-sampling and we would like to see the same results each time we compile this file. You can change the seed argument if you want.
```{r}
set.seed(60637)
```


**(1a)**

In the ggl data, the unit of observation is an **individual voter**, but treatment is assigned at the **household** level. Because there are multiple eligible voters in many households, the researchers thought people might talk about their treatments with other people in their households, and there could be treatment effect spillovers within households. Assigning the same treatment at the household level is a way to avoid this.

**Using `group_by` and `summarize`, get counts of *households* (not individuals) in each treatment condition.** 

```{r}
ggl %>% 
  group_by(treatment) %>% 
  summarize(n_hh = length(unique(hh_id)))
```


**(1b) Does it look like the probability of assigning treatment is the same across treatment and control?** 

```{r}
probs <- 
```


**(1c) Regress `p2004` on `treatment`. Show the `R` output. Save the average treatment effect using `coef()` to extract the model coefficient. Exclude the intercept.** 


```{r}
lm1 <- lm_robust(p2004 ~ treatment, data = ggl)
lm1

(ate <- coef(lm1)[-1])

```

**(1c) Create a copy of the `ggl` data called `ggl2`. In this new data, create a new variable called `D`, which takes the value 1 if the observation was assigned the CivicDuty condition, and 0 if the observation was assigned control. **

```{r}
ggl2 <- ggl%>% 
  mutate(D = 1*(treatment == 'CivicDuty'))
```

**(1d) In the ggl2 dataset, create a variable called `newD`, where you resample from D, keeping **

```{r}



```




## Question 2: Sampling Inference

